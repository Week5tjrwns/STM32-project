***EV Brake System ECU Firmware Practice***

**프로젝트 개요**

직무 부트캠프에서 진행한 전기차(EV) 브레이크 시스템용 ECU 펌웨어 개발 실습입니다.
실제 차량의 제어기(ECU)가 통신하는 방식을 모사하여, 전력 관리 칩(PMIC)을 제어하고 고장 코드(DTC)를 관리하는 로직을 구현했습니다.
온라인 실습 환경이라 실제 하드웨어는 없었지만, 데이터시트를 보고 레지스터를 설정하거나 RTOS 환경에서 태스크를 관리하는 SW 로직 구현에 집중했습니다.

기간: 2025.07 ~ 2025.08 (직무 부트캠프)

목표: 차량용 통신 프로토콜(CAN, I2C, SPI) 드라이버 구현 및 RTOS 태스크 동기화

환경: STM32CubeIDE, STM32F413ZH, FreeRTOS



**주요 기능 구현**

RTOS 환경에서 4개의 태스크가 Mutex를 주고받으며 순서대로 동작하도록 설계했습니다.

통신 및 제어 

PMIC 제어 (I2C): DMA 방식을 사용하여 PMIC의 상태 레지스터를 읽고, 저전압(UV)이나 과전류(OC) 같은 결함을 감지합니다.

데이터 저장 (SPI): 고장이 발생하면 EEPROM에 진단 코드(DTC)를 저장하여 전원이 꺼져도 기록이 남게 했습니다.

상태 전송 (CAN): 차량 내부 네트워크로 현재 시스템 상태와 고장 정보를 전송합니다. 인터럽트 방식으로 구현하여 응답성을 높였습니다.

로그 출력 (UART): 디버깅을 위해 PC 터미널로 "ECU OK" 같은 상태 메시지를 주기적으로 출력합니다.

RTOS 구성

FreeRTOS를 사용하여 기능별로 태스크를 분리했습니다.

I2C -> SPI -> CAN -> UART 순서로 자원을 쓰기 위해 Mutex를 사용하여 동기화를 맞췄습니다.



**문제 해결 (CANoe 로그 분석)**

개발 과정에서 발생한 이슈를 HILS 장비의 로그(CANoe)를 분석하여 해결했습니다.

ISSUE 1: 다운로드 타이밍 오류

현상: 브레이크에 압력이 차 있는데도 소프트웨어 다운로드가 시작되는 문제가 있었습니다.

해결: 다운로드 진입 조건에 '브레이크 압력 센서값이 0일 때만 가능'하도록 조건문을 추가하여 해결했습니다.

ISSUE 2: 고장 시 모터 오동작 

현상: PMIC에서 전원 오류(Fault)가 감지되었는데도 모터와 밸브가 계속 동작하는 위험한 상태가 확인되었습니다.

해결: Fault 플래그가 뜨면 즉시 모터와 밸브 제어 신호를 0으로 강제 차단하는 안전 로직을 추가했습니다.


